{"ruleId":"S3PublicAccess","ruleversion":"1.0","description":"Ensure that S3 Buckets are configured with Block public access (bucket settings)","disabled":false,"ruleDefinition":"@info(name = 'query1')from aws_s3 select json:toObject(awsS3) as obj insert into temp;@info(name = 'query2')from temp select json:getString(obj, '$.awsS3.ResourceType') as affected_resource_type, json:getString(obj, '$.awsS3.Details.Name') as affected_resource_name, ifThenElse( json:getBool(obj, '$.awsS3.AccessBlock.PublicAccessBlockConfiguration.BlockPublicAcls') == true and json:getBool(obj, '$.awsS3.AccessBlock.PublicAccessBlockConfiguration.IgnorePublicAcls') == true and json:getBool(obj, '$.awsS3.AccessBlock.PublicAccessBlockConfiguration.BlockPublicPolicy') == true and json:getBool(obj, '$.awsS3.AccessBlock.PublicAccessBlockConfiguration.RestrictPublicBuckets') == true, 'False', 'True') as is_publicly_accessible insert into temp2;@info(name = 'query3')from temp2[is_publicly_accessible == 'True'] select affected_resource_type, affected_resource_name, is_publicly_accessible insert into s3_outputstream;","action":"add","type":["aws_s3"]}